{{#*inline "schemaFields"}}
{{#each this ~}}
  {{~#compare this.showInTableView '!==' false '&&' @key '!==' @root.primaryFieldKey}}
    {{~#compare this.input '||' this.showInTableView '&&' @key '!==' @root.urlFieldKey }}
      {{#if this.dataIndex}}
{{convertDataIndexToGraphqlSubQuery (concat @key '.' this.dataIndex) 3}}
      {{else}}
        {{#if this.reference.labelKey}}
{{convertDataIndexToGraphqlSubQuery (concat @key '.' this.reference.labelKey) 3}}
        {{else}}
          {{#compare this.fields 'typeof' 'object'}}
{{@key}} {
  {{> schemaFields this.fields}}
}
          {{else}}
{{@key}}
          {{/compare}}  
        {{/if}}
      {{/if}}
    {{/compare~}}
  {{/compare~}}
{{/each}}
{{/inline}}
{{#*inline "filterParameter"}}
  {{#compare this.type 'in' 'String|Int|Float|Number'}}
${{ name }}: [{{cleanGraphqlType this.type}}],
  {{else}}
${{ name }}: {{cleanGraphqlType this.type}},
  {{/compare}}
{{/inline}}
{{#*inline "queryParameter"}}
{{ name }}: ${{name}},
{{/inline~}}

#import "../fragments/{{ pascalCase pluralName }}.gql"

query {{ camelCase pluralName }}(
  $_ids: [String]
  $page: Int, 
  $pageSize: Int, 
  $search: String, 
  $sort: String, 
  $order: String,
{{#each schema.fields}}
  {{#if this.filterable}}
    {{#compare this.input 'typeof' 'object'}}
  {{> filterParameter this.input}}
    {{else}}
  {{> filterParameter name=@key}}
    {{/compare}}
  {{/if}}
{{/each}}
) {
  {{ camelCase pluralName }}(
    _ids: $_ids,
    page: $page, 
    pageSize: $pageSize, 
    search: $search, 
    sort: $sort, 
    order: $order,
{{#each schema.fields}}
  {{#if this.filterable}}
    {{#compare this.input 'typeof' 'object'}}
    {{> queryParameter this.input}}
    {{else}}
    {{> queryParameter name=@key}}
    {{/compare}}
  {{/if}}
{{/each}}
  ) {
    total
    {{ camelCase pluralName }} {
      {{primaryFieldKey}}
      {{#compare primaryFieldKey '!==' urlFieldKey}}{{urlFieldKey}}{{/compare}}
      {{> schemaFields schema.fields }} 
    }
  }
}

query edit{{ pascalCase singularName }}(${{ primaryFieldKey }}: {{ primaryField.type }}{{#compare primaryFieldKey '!==' urlFieldKey }}, ${{ urlFieldKey }}: {{ urlField.type }}{{/compare}}) {
  {{ camelCase singularName }}({{ primaryFieldKey }}: ${{ primaryFieldKey }}{{#compare primaryFieldKey '!==' urlFieldKey }}, {{ urlFieldKey }}: ${{ urlFieldKey }}{{/compare}}) {
    ...{{ pascalCase singularName }}Attributes
  }
}

query {{ camelCase singularName }}(${{ primaryFieldKey }}: {{ primaryField.type }}{{#compare primaryFieldKey '!==' urlFieldKey }}, ${{ urlFieldKey }}: {{ urlField.type }}{{/compare}}) {
  {{ camelCase singularName }}({{ primaryFieldKey }}: ${{ primaryFieldKey }}{{#compare primaryFieldKey '!==' urlFieldKey }}, {{ urlFieldKey }}: ${{ urlFieldKey }}{{/compare}}) {
    ...{{ pascalCase singularName }}Attributes
  }
}
